<div class="card" style="border-left: 4px solid var(--neon-blue);">
        <div class="profile-module">
            <div class="profile-info-group">
                <div class="profile-avatar">
                    <i class="fa-solid fa-user-astronaut"></i>
                </div>
                <div class="profile-text">
                    <h4 id="profileName">Loading... <span class="badge-role">ADMIN</span></h4>
                    <p id="profileEmail">loading@system.core</p>
                </div>
            </div>
            <button class="btn-edit" onclick="toggleEditProfile()"><i class="fa-solid fa-pen-to-square"></i> Edit Identity</button>
        </div>

        <div class="edit-form-container" id="editProfileForm">
            <div class="form-row">
                <label style="width:100px; color:var(--text-muted); padding-top:10px;">Username:</label>
                <input type="text" id="editUsernameInput" class="form-input" placeholder="New Username">
            </div>
            <div class="form-row">
                <label style="width:100px; color:var(--text-muted); padding-top:10px;">Password:</label>
                <input type="password" id="editPasswordInput" class="form-input" placeholder="New Password (Biarkan kosong jika tak nak ubah)">
            </div>
            <div class="form-row">
                <button class="btn-save" onclick="saveProfileChanges()">Update Record</button>
                <button class="btn-cancel" onclick="toggleEditProfile()">Cancel</button>
            </div>
            <p style="font-size:12px; color: #ffaa00; margin-top:5px;">* Note: Changing password requires recent login.</p>
        </div>
    </div>
    ```

### 2. Update Bahagian Script (Javascript)
Gantikan keseluruhan fungsi `saveProfileChanges` dan `firebase.auth().onAuthStateChanged` dengan kod di bawah ini. Saya telah ubah logiknya supaya lebih "kuat" dan support tukar password.

```javascript
// --- AUTH & PROFILE LOGIC ---
firebase.auth().onAuthStateChanged(async (user) => {
  if (user) {
    currentUserDocId = user.uid; // Capture UID
    
    // Paparkan Email (Read Only)
    document.getElementById("profileEmail").textContent = user.email;

    try {
      // Get User Data dari Firestore
      const doc = await db.collection("admin_users").doc(user.uid).get();
      
      let username = "Admin Officer"; // Default name

      if (doc.exists) {
        const data = doc.data();
        if(data.username) username = data.username;
      } else {
        // Jika document tiada, kita create satu 'placeholder' dalam memory dulu
        console.log("Profile document not found, creating default view.");
      }
      
      // Update UI
      welcomeMsg.innerHTML = "Welcome back, <strong>" + username + "</strong>";
      document.getElementById("profileName").innerHTML = username + ' <span class="badge-role">ADMIN</span>';
      
      // Masukkan data dalam form siap-siap
      document.getElementById("editUsernameInput").value = username;

    } catch (error) {
      console.error("Error fetching user data:", error);
    }
  } else {
    // Redirect if not logged in
    window.location.href="login.html";
  }
});

// --- PROFILE EDIT FUNCTIONS (UPDATED) ---
function toggleEditProfile() {
    const form = document.getElementById("editProfileForm");
    // Clear password input bila tutup/buka
    document.getElementById("editPasswordInput").value = ""; 
    
    if (form.style.display === "block") {
        form.style.display = "none";
    } else {
        form.style.display = "block";
    }
}

async function saveProfileChanges() {
    const newName = document.getElementById("editUsernameInput").value;
    const newPass = document.getElementById("editPasswordInput").value;
    const user = firebase.auth().currentUser;

    if(!newName.trim()) {
        alert("Username cannot be empty");
        return;
    }

    if(!user) {
        alert("No user logged in.");
        return;
    }

    try {
        // 1. Update Username dalam Firestore
        // Kita guna .set() dengan {merge: true}.
        // Ini akan betulkan masalah "Data Tak Masuk" kalau document belum wujud.
        await db.collection("admin_users").doc(user.uid).set({
            username: newName,
            email: user.email // Simpan email juga untuk rujukan database
        }, { merge: true });

        // 2. Update Password (Jika user isi kotak password)
        if (newPass.trim() !== "") {
            if (newPass.length < 6) {
                alert("Password must be at least 6 characters.");
                return;
            }
            await user.updatePassword(newPass);
            console.log("Password updated successfully");
        }

        // 3. Success Feedback
        alert("Profile Updated Successfully!");
        
        // Refresh UI serta-merta
        document.getElementById("profileName").innerHTML = newName + ' <span class="badge-role">ADMIN</span>';
        welcomeMsg.innerHTML = "Welcome back, <strong>" + newName + "</strong>";
        
        toggleEditProfile(); // Tutup form

    } catch (error) {
        console.error("Error updating profile: ", error);
        
        // Error Handling khas untuk Password
        if (error.code === 'auth/requires-recent-login') {
            alert("Security Alert: Untuk tukar password, sila Sign Out dan Login semula, kemudian cuba lagi.");
        } else {
            alert("Error: " + error.message);
        }
    }
}
